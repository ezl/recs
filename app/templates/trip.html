{% extends "base.html" %}

{% block title %}Recommendations for {{ trip.traveler_name }}'s Trip to {{ trip.destination }} | Recs{% endblock %}

{% block head_extras %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/recommendations.css') }}">
{% endblock %}

{% block content %}
<div class="page-container py-10">
  <div class="mb-10">
    <h1 class="page-title">
      {{ trip.traveler_name }}, you're going to {{ trip.destination }}!
    </h1>
    
    <!-- Include share box component -->
    {% with 
      id = trip.id, 
      title = "Ask your friends for recommendations", 
      description = "Send this link to your friends or post it on social media to get recommendations!", 
      share_url = url_for('recommendation.add_recommendation', slug=trip.slug, _external=True) 
    %}
      {% include 'components/share_box.html' %}
    {% endwith %}
  </div>

  <!-- Include destination information card component -->
  {% include 'components/destination_info_card.html' %}

  {% if trip.recommendations %}
    <div class="mb-8">
      <div class="flex items-center justify-between mb-2">
        <h2 class="section-title">
          Recommendations for {{ trip.traveler_name }}
        </h2>
        <div class="flex items-center space-x-2">
          <!-- View toggle buttons -->
          <div class="flex border border-gray-200 rounded-md overflow-hidden mr-2">
            <button id="card-view-btn" class="inline-flex items-center px-3 py-1.5 bg-blue-100 text-blue-800 text-sm font-medium">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
              </svg>
              Cards
            </button>
            <button id="map-view-btn" class="inline-flex items-center px-3 py-1.5 bg-white text-gray-600 hover:text-gray-900 text-sm font-medium">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4" />
              </svg>
              Map
            </button>
          </div>
          
          <!-- Include search controls component -->
          {% include 'components/trip/_search_controls.html' %}
          
          <button id="toggle-filters" class="inline-flex items-center px-2 py-1 text-gray-600 hover:text-gray-900 transition">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
            </svg>
            <span class="ml-1">Filter</span>
          </button>
        </div>
      </div>
      
      <p class="text-gray-600 text-sm mb-4">
        {% set grouped_recommendations = trip.get_grouped_recommendations() %}
        {% set contributors = trip.get_contributors() %}
        {{ contributors|length }} contributors, {{ grouped_recommendations|length }} activities, {{ trip.recommendations|length }} recommendations
      </p>
      
      <!-- Include filter controls component -->
      {% include 'components/trip/_filter_controls.html' %}
      
      <!-- Card View Container -->
      <div id="card-view" class="grid md:grid-cols-2 gap-6">
        {% for group in grouped_recommendations %}
          {% include 'components/trip/_recommendation_card.html' %}
        {% endfor %}
      </div>
      
      <!-- Include map view component -->
      {% include 'components/trip/_map_view.html' %}
    </div>
  {% else %}
    <div class="card mb-8 bg-gray-50 text-center">
      <h2 class="text-xl font-semibold text-gray-700 mb-3">No recommendations yet</h2>
      <p class="text-gray-500 mt-10 mb-10">Your friends' recommendations will show up here</p>
    </div>
  {% endif %}
  
</div>
{% endblock %}

{% block scripts %}
<!-- Google Maps API Script -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ config.GOOGLE_MAPS_API_KEY }}&callback=initMap" async defer></script>

<!-- Trip page component scripts -->
<script src="{{ url_for('static', filename='js/components/trip/view_toggler.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/trip/recommendation_filter.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/trip/recommendation_map.js') }}"></script>
<script src="{{ url_for('static', filename='js/pages/trip.js') }}"></script>

<style>
  .search-hidden {
    display: none;
  }
</style>
{% endblock %} 